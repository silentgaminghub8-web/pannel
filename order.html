<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mobile Page</title>
    <style>
        /* --- Global & Page Styles --- */
        :root {
            --primary-blue: #007bff;
            --light-grey: #f0f2f2;
            --medium-grey: #ccc;
            --text-color: #0F1111;
            --success-green: #28a745;
            --danger-red: #dc3545;
            --dark-grey: #343a40;
            --light-blue: #e6f3ff;
        }
        /* COMMAND 1: Disable Text Selection & Tap Highlight */
        * {
            -webkit-tap-highlight-color: transparent; /* For iOS/Android */
            -webkit-touch-callout: none; /* Disable callout, like on image long-press */
            -webkit-user-select: none;   /* Safari */
            -khtml-user-select: none;    /* Konqueror HTML */
            -moz-user-select: none;      /* Old versions of Firefox */
            -ms-user-select: none;       /* Internet Explorer/Edge */
            user-select: none;           /* Non-prefixed version, currently supported by Chrome, Opera, and Firefox */
        }
        /* Re-enable selection for form inputs */
        input, textarea, select {
            -webkit-user-select: auto;
            -khtml-user-select: auto;
            -moz-user-select: auto;
            -ms-user-select: auto;
            user-select: auto;
        }

        /* General Body and Page Setup */
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #ffffff;
            color: #0F1111;
        }

        .page {
            display: none; /* Pages are hidden by default */
            padding-bottom: 100px; /* Space for the footer */
        }

        .page.active {
            display: block; /* The active page is shown */
        }
        
        #home-page {
             background-color: var(--light-grey);
        }
        
        #home-page .content {
             /* Padding-top and bottom set by JS */
             padding-top: 100px;
             padding-bottom: 100px;
        }

        #progress-bar-loader {
            position: fixed;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: transparent;
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0s linear 0.4s;
            overflow: hidden;
        }
        #progress-bar-loader.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.1s ease, visibility 0s;
        }
        #progress-bar-loader::before {
            content: '';
            display: block;
            height: 100%;
            width: 100%;
            background-image: linear-gradient(to right, #FFA41C, #FFD814, #FFA41C);
            background-size: 200% auto;
            animation: progressBarFlow 1.2s linear infinite;
        }
        @keyframes progressBarFlow {
            0% { background-position: 0% 0; }
            100% { background-position: -100% 0; }
        }
        .content-loading {
            visibility: hidden;
            min-height: 500px; /* Prevent page jumping */
        }


        /* Header and Footer (Fixed Overlays) */
        .fixed-header, .fixed-footer {
            position: fixed;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1000;
        }

        .fixed-header {
            top: 0;
            background-color: #ffffff;
        }

        .fixed-footer {
            bottom: 0;
            cursor: pointer;
        }

        .fixed-header img, .fixed-footer img, img.full-width-image, .full-width-image img {
            width: 100%;
            height: auto;
            display: block;
        }
        .full-width-image.no-gap { margin-top: -1px; }

        /* Invisible Back Button Tap Area */
        #back-tap-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 25%;
            height: 100%;
            z-index: 1001;
        }
        
        /* --- Home Page Modules --- */
        #home-page .module {
            background-color: #fff;
            padding: 15px;
            margin-bottom: 10px;
        }
        #home-page .module-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px;
        }
        #home-page .module-title { font-weight: bold; font-size: 18px; }
        .see-all, .edit-button {
            text-decoration: none; color: var(--primary-blue); font-size: 14px;
            background: none; border: none; cursor: pointer; padding: 0;
        }
        .edit-button { margin-right: 5px; }


        /* Quick Access Pills */
        .quick-access {
            background-color: #fff; overflow-x: auto; white-space: nowrap;
            padding: 15px; border-bottom: 1px solid #ddd;
        }
        .quick-access-inner { display: inline-block; }
        .pill-button {
            background-color: #fff; border: 1px solid var(--medium-grey); border-radius: 50px;
            padding: 10px 20px; margin-right: 10px; font-size: 14px; cursor: pointer;
        }

        /* Card Row for Home Page */
        .card-row { display: flex; overflow-x: auto; padding-bottom: 15px; }
        .card-row::-webkit-scrollbar { display: none; }
        .card {
            flex: 0 0 140px; width: 140px; height: 140px;
            background-color: #fff; border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            margin-right: 10px; display: flex; align-items: center;
            justify-content: center; padding: 10px; box-sizing: border-box;
        }
        .card img { max-width: 100%; max-height: 100%; object-fit: contain; }
        .placeholder-text { color: #666; font-size: 14px; padding-left: 5px; }

        /* "Keep Shopping" Footer on Home Page */
        #home-page .module-footer { text-align: center; margin-top: 10px; }
        .see-more-link {
            color: #555; text-decoration: none; display: inline-flex;
            align-items: center; font-size: 14px;
        }
        .arrow-down { width: 24px; height: 24px; fill: currentColor; }
        
        /* "Your Lists" Module on Home Page */
        .list-card {
            display: flex; align-items: center; justify-content: space-between;
            padding: 15px; border: 1px solid #ddd; border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .list-card-text { display: flex; flex-direction: column; }
        .list-title { font-weight: bold; }
        .list-subtitle { font-size: 12px; color: #555; }
        .list-card-previews { display: flex; gap: 5px; }
        .preview-square {
            width: 40px; height: 40px; background-color: #f0f0f0;
            border-radius: 4px; background-size: cover; background-position: center;
        }
        .extra-items {
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold; color: #333;
        }

        /* "Your Account" Module on Home Page */
        .account-buttons { display: flex; gap: 10px; }
        .account-button {
            flex: 1; padding: 15px 10px; font-size: 14px;
            background-color: #fff; border: 1px solid #ddd;
            border-radius: 8px; text-align: center; cursor: pointer;
        }

        /* "Need Help" Module on Home Page */
        .help-module { text-align: center; }
        .help-title { font-size: 18px; margin-bottom: 15px; }
        .help-button {
            width: calc(100% - 20px); padding: 15px; background-color: #fff;
            border: 1px solid #ddd; border-radius: 8px; font-size: 16px;
            cursor: pointer; margin: 0 auto;
        }

        /* --- Orders Page Specific Styles --- */
        #orders-page .admin-panel-link img {
            width: 100%;
            cursor: pointer;
            height: auto;
            display: block;
        }

        #orders-page .module {
            padding: 16px;
        }

        #orders-page .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        #orders-page .module-header h2 {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0;
        }

        #orders-page .module-header .see-more {
            font-size: 0.9rem;
            color: #007185;
            text-decoration: none;
            font-weight: normal;
            cursor: pointer;
        }

        .buy-again-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .buy-again-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            text-align: center;
        }

        .buy-again-card img {
            max-width: 100%;
            height: 100px;
            object-fit: contain;
            margin-bottom: 8px;
        }

        .buy-again-card p {
            margin: 0;
            font-size: 0.9rem;
            text-align: left;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .separator {
            height: 8px;
            background-color: #EAEDED;
            border: none;
            margin: 0;
        }

        .purchase-history-header h2 {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0 0 4px 0;
        }

        .purchase-history-header p {
            font-size: 0.9rem;
            color: #565959;
            margin: 0;
        }

        .purchase-item-card {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 12px;
            background-color: #fff;
            overflow: hidden;
            align-items: stretch;
            height: 100px;
        }

        .purchase-item-card .item-image {
            flex-basis: 90px;
            flex-shrink: 0;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-right: 1px solid #eee;
            background-color: #F0F2F2;
        }

        .purchase-item-card .item-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .purchase-item-card .item-info {
            flex-grow: 1;
            padding: 12px 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            overflow: hidden;
        }

        .purchase-item-card .item-info .item-name {
            font-weight: bold;
            margin: 0 0 4px 0;
            color: #0F1111;
            cursor: pointer;
            text-decoration: none;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

         .purchase-item-card .item-info .item-name:hover {
            color: #007185;
         }

        .purchase-item-card .item-info .item-status {
            font-size: 0.9rem;
            color: #565959;
            margin: 0;
        }

        /* --- Order Details Page Styles --- */
        .product-info-module {
            display: flex;
            padding: 16px;
            gap: 16px;
            align-items: flex-start;
        }

        .product-info-module .product-image {
            width: 150px;
            height: 150px;
            object-fit: contain;
        }

        .product-info-module .product-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 150px; /* Match image height */
        }

        .product-info-module .product-details .product-name {
            color: #007185;
            font-weight: normal;
            text-decoration: none;
            font-size: 0.9rem;
            display: block;
            margin-bottom: 8px;
        }
        .product-info-module .product-details .product-name:hover {
            text-decoration: underline;
        }

        .product-info-module .product-details .share-item {
            color: #007185;
            text-decoration: none;
            font-size: 0.9rem;
            cursor: pointer;
        }
        .product-info-module .product-details .share-item:hover {
            text-decoration: underline;
        }

        .delivery-status-module {
            padding: 16px;
            border-top: 1px solid #ddd;
        }

        .delivery-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .delivery-status .icon {
            background-color: #007185;
            color: white;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-weight: bold;
        }

        .delivery-status .text-bold {
            font-weight: bold;
        }

        .delivery-feedback {
            margin-bottom: 16px;
        }

        .delivery-feedback .feedback-text {
            font-size: 0.8rem;
            color: #565959;
            margin-bottom: 4px;
        }

        .delivery-feedback .stars {
            color: #FFA41C;
            font-size: 1.5rem;
        }

        .list-button {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #ddd;
            text-decoration: none;
            color: inherit;
        }

        .list-button .button-text {
            display: flex;
            flex-direction: column;
        }

        .list-button .button-text .sub-text {
            font-size: 0.8rem;
            color: #565959;
            margin-top: 2px;
        }

        .list-button .arrow {
            color: #888;
        }

        .module-with-buttons {
            padding: 0 16px;
        }
        
        .module-with-buttons .list-button:first-of-type {
            border-top: 1px solid #ddd;
        }

        .module-with-buttons h3 {
            font-size: 1.2rem;
            font-weight: bold;
            margin-top: 16px;
            margin-bottom: 8px;
        }

        .details-page-footer {
            padding: 16px;
            color: #565959;
            font-size: 0.9rem;
        }
        
        #image-page-content img {
            width: 100%;
            height: auto;
            display: block;
        }

        .details-page-ad-image {
            width: 100%;
            display: block;
            height: auto;
        }

        /* --- Track Page Styles --- */
        .track-module {
            padding: 16px;
        }
        .track-module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .track-module-header h2 {
            font-size: 1rem;
            font-weight: bold;
            margin: 0;
            flex-grow: 1;
        }
        .track-module-header .see-all-orders {
            font-size: 0.9rem;
            color: #007185;
            text-decoration: none;
            font-weight: normal;
            white-space: nowrap;
        }
        .thin-separator {
            border: none;
            border-top: 1px solid #ddd;
            margin: 0 -16px;
        }
        .track-module .full-width-image {
            margin: 0 -16px;
            width: calc(100% + 32px);
        }
        .thick-separator {
            border: none;
            border-top: 8px solid #EAEDED;
            margin: 0 -16px 16px -16px;
        }
        .shipping-address-section h3 {
             font-size: 1.2rem;
             margin: 0 0 8px 0;
        }
        .shipping-address-section p {
            margin: 0;
            font-size: 1rem;
            line-height: 1.4;
            white-space: pre-wrap;
        }
        .order-info-section h2 {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .thick-separator-light {
             border: none;
             border-top: 1px solid #ddd;
             margin: 0;
        }
        .order-details-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            text-decoration: none;
            color: inherit;
            font-size: 1rem;
        }

        /* Track Page Sticky Header */
        .sticky-track-header {
            position: sticky;
            background-color: #ffffff;
            z-index: 999;
            padding-bottom: 0 !important;
        }
        .track-product-image-container {
            padding: 16px 0;
            text-align: left;
        }
        .track-product-image {
            max-width: 80px;
            max-height: 80px;
            object-fit: contain;
        }
        
        /* Action Button Carousel */
        .button-carousel {
            display: flex;
            overflow-x: auto;
            flex-wrap: nowrap;
            padding: 16px;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .button-carousel::-webkit-scrollbar {
            display: none;
        }
        .action-button {
            padding: 10px 16px;
            margin-right: 12px;
            flex-shrink: 0;
            max-width: 180px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 16px;
            color: #222;
            font-size: 14px;
            font-weight: 500;
            text-align: center;
            line-height: 1.4;
            white-space: normal;
            cursor: pointer;
            text-decoration: none;
        }
        .action-button:hover {
            background-color: #f0f0f0;
        }
        .action-button:last-child {
            margin-right: 0;
        }

        .shipped-with-info {
            padding: 0 16px 16px 16px;
        }
        .shipped-with-info h3 {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0 0 8px 0;
        }
        .shipped-with-info p, .shipped-with-info a {
            font-size: 1rem;
            margin: 0 0 4px 0;
            color: #007185;
            text-decoration: none;
        }
        
        /* --- Order Summary Page Styles --- */
        #order-summary-page .content {
            background-color: #EAEDED;
        }
        .summary-top-bar {
            background-color: #f0f2f2;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #ddd;
        }
        .summary-top-bar .back-arrow {
            font-size: 1.5rem;
            font-weight: bold;
            margin-right: 16px;
            cursor: pointer;
        }
        .summary-top-bar .title {
            font-size: 1.2rem;
            font-weight: bold;
        }
        .summary-card {
            background-color: #ffffff;
            margin-bottom: 8px;
            padding: 16px;
        }
        .summary-card h2 {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 0 0 12px 0;
        }
        .summary-card .card-line {
            border: none;
            border-top: 1px solid #ddd;
            margin-top: 12px;
            margin-bottom: 12px;
        }
        .summary-grid {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .summary-grid .label { font-weight: bold; }
        .summary-grid .label.regular { font-weight: normal; }
        .summary-grid .value { text-align: right; }
        
        .summary-nav-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #007185;
            cursor: pointer;
        }
        .summary-nav-row .arrow { font-weight: bold; }
        
        .product-card-delivery-status h2 { margin-bottom: 2px; }
        .product-card-delivery-status p {
            margin: 0 0 12px 0;
            font-size: 0.9rem;
            color: #565959;
        }
        
        .product-card-info {
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 16px;
            align-items: flex-start;
        }
        .product-card-info img {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }
        .product-card-info .details p {
            margin: 0 0 6px 0;
            font-size: 1rem;
            line-height: 1.4;
        }
        .product-card-info .details p.title { font-weight: bold; }
        .product-card-info .details p.price { font-weight: bold; font-size: 1.1rem; }
        .product-card-info .details p .seller-label { color: grey; }
        .product-card-info .details p .seller-name { color: #007185; text-decoration: none; }


        .summary-button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }
        .summary-action-button {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px 14px;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: none;
            color: #0F1111;
            display: inline-block;
        }
        
        .payment-card p {
            margin: 0 0 4px 0;
            font-size: 1rem;
        }
        .address-card p {
            margin: 0;
            font-size: 1rem;
            line-height: 1.5;
            white-space: pre-wrap;
        }
        
        .summary-card .summary-grid .value.bold {
            font-weight: bold;
        }


        /* --- REDESIGNED ADMIN PANEL STYLES --- */
        #admin-page .content { padding: 0; background-color: #f8f9fa; }
        .admin-header-main {
            background-color: #fff;
            padding: 15px 20px;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-header-main h1 { margin: 0; font-size: 1.5rem; }
        .admin-header-main a { color: var(--primary-blue); text-decoration: none; }
        
        .admin-tabs-container { display: flex; background-color: #f1f1f1; border-bottom: 1px solid #ddd; }
        .admin-tab-button {
            flex: 1; padding: 15px 10px; text-align: center; cursor: pointer;
            background-color: transparent; color: #6c757d; border: none; border-bottom: 3px solid transparent;
            font-size: 1rem; font-weight: 500; transition: all 0.2s ease-in-out;
        }
        .admin-tab-button.active { border-bottom-color: var(--primary-blue); color: var(--primary-blue); background-color: #fff; }

        .admin-tab-content { display: none; padding: 20px; }
        .admin-tab-content.active { display: block; }
        
        .admin-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .admin-section-header h2 { margin: 0; font-size: 1.25rem; }
        .admin-button {
             background-color: var(--primary-blue); color: white; padding: 10px 15px;
             border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem;
             text-decoration: none; display: inline-flex; align-items: center; gap: 5px;
        }
        .admin-button.secondary { background-color: var(--success-green); }
        .admin-button:hover { opacity: 0.9; }

        .item-list-admin { list-style: none; padding: 0; display: grid; gap: 15px; }
        .item-list-admin-card {
            background-color: #fff; border: 1px solid #ddd; border-radius: 8px;
            padding: 15px; display: flex; align-items: center; gap: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: relative;
        }
        /* Drag and Drop Styles */
        .item-list-admin-card.dragging { opacity: 0.5; background-color: var(--light-blue); }
        .item-list-admin-card.drag-over-top::before, .item-list-admin-card.drag-over-bottom::after {
            content: ''; position: absolute; left: 0; right: 0; height: 4px;
            background-color: var(--primary-blue);
        }
        .item-list-admin-card.drag-over-top::before { top: -2px; }
        .item-list-admin-card.drag-over-bottom::after { bottom: -2px; }
        
        .item-list-admin-card .item-preview {
            width: 50px; height: 50px; flex-shrink: 0;
            background-color: #eee; border-radius: 4px;
            background-size: contain; background-position: center; background-repeat: no-repeat;
            cursor: grab;
        }
        .item-list-admin-card:active { cursor: grabbing; }
        
        .item-list-admin-card .item-info-admin { flex-grow: 1; }
        .item-list-admin-card .item-info-admin p { margin: 0; font-weight: 600; }
        .item-list-admin-card .item-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .item-list-admin-card .item-actions button {
            padding: 8px 10px; border-radius: 5px; border: none; cursor: pointer;
            font-size: 0.8rem; color: #fff;
        }
        .admin-edit-btn { background-color: var(--primary-blue); }
        .admin-delete-btn { background-color: var(--danger-red); }
        .admin-duplicate-btn { background-color: var(--success-green); }
        
        .admin-settings-form { background-color: #fff; padding: 20px; border-radius: 8px; border: 1px solid #ddd; }
        .admin-settings-form label { display: block; margin-bottom: 5px; font-weight: bold; }
        .admin-settings-form input[type="url"] {
            width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box; margin-bottom: 10px;
        }
        .admin-settings-form button { margin-top: 15px; }

        /* Admin Modal Styles */
        .admin-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .admin-modal-overlay.visible { display: flex; opacity: 1; }
        .admin-modal {
            background: #f8f9fa; width: 95%; max-width: 600px; border-radius: 12px;
            max-height: 90vh; display: flex; flex-direction: column;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: scale(0.95); transition: transform 0.3s ease;
        }
        .admin-modal-overlay.visible .admin-modal { transform: scale(1); }
        .modal-header {
            padding: 15px 20px; border-bottom: 1px solid #ddd;
            display: flex; justify-content: space-between; align-items: center;
        }
        .modal-header h2 { margin: 0; font-size: 1.2rem; }
        .modal-close-btn { background: none; border: none; font-size: 1.8rem; cursor: pointer; color: #888; }
        .modal-body { overflow-y: auto; padding: 20px; }
        .modal-footer {
            padding: 15px 20px; border-top: 1px solid #eee; background: #fff;
            display: flex; justify-content: flex-end; gap: 10px;
        }
        .form-section-accordion { border: 1px solid #ddd; border-radius: 8px; margin-bottom: 15px; background: #fff; }
        .form-section-accordion summary {
            padding: 15px; font-weight: 600; cursor: pointer;
            list-style: none; display: flex; justify-content: space-between; align-items: center;
        }
        .form-section-accordion summary::-webkit-details-marker { display: none; }
        .form-section-accordion summary:after { content: '▼'; font-size: 0.8em; }
        .form-section-accordion[open] summary:after { content: '▲'; }
        .form-section-accordion-content { padding: 0 15px 15px 15px; }
        
        .form-input-group { margin-bottom: 15px; }
        .form-input-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem; }
        .form-input-group input, .form-input-group select, .form-input-group textarea {
            width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc;
            box-sizing: border-box; font-family: inherit; font-size: 1rem;
        }
        .form-checkbox-group { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .form-checkbox-group input { width: auto; }
        
        /* --- Old Admin Panel Overlay Styles (For Home Page) --- */
        .admin-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); z-index: 100;
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .admin-overlay.visible { display: flex; opacity: 1; }
        .admin-overlay .admin-container {
            width: 90%; max-width: 700px; background-color: #fff;
            border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; overflow: hidden; height: 90vh; max-height: 800px;
            padding: 0; /* Override default padding */
        }
        .admin-overlay .admin-header {
            padding: 20px; border-bottom: 1px solid #eee;
        }
        .admin-overlay .admin-header h1 { margin: 0 0 5px 0; font-size: 22px; text-align: left;}
        .admin-overlay .admin-header p { margin: 0; color: #666; }
        .admin-overlay .admin-tabs { display: flex; border-bottom: 1px solid #eee; }
        .admin-overlay .admin-tab {
            flex: 1; padding: 15px 10px; text-align: center; cursor: pointer;
            background-color: #f8f9fa; color: #6c757d; border-bottom: 3px solid transparent;
            transition: background-color 0.2s, border-color 0.2s; white-space: nowrap;
        }
        .admin-overlay .admin-tab.active { background-color: #fff; border-bottom-color: var(--primary-blue); color: #000; }
        .admin-overlay .admin-content { flex-grow: 1; overflow-y: auto; padding: 20px; }
        .admin-overlay .admin-tab-content { display: none; }
        .admin-overlay .admin-tab-content.active { display: block; }
        .admin-note { color: #555; font-size: 14px; margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #eee; margin-bottom: 15px; }
        .url-input-group { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
        .url-preview {
            width: 50px; height: 50px; flex-shrink: 0; background-color: #eee;
            border-radius: 6px; background-size: cover; background-position: center;
        }
        .url-input {
            flex-grow: 1; padding: 12px; border: 1px solid var(--medium-grey);
            border-radius: 4px; font-size: 14px;
        }
        .remove-url-btn {
            background: #e6e6e6; border: none; color: #555; font-weight: bold; width: 30px; height: 30px;
            border-radius: 50%; cursor: pointer; flex-shrink: 0;
        }
        .remove-url-btn:hover { background-color: var(--danger-red); color: white; }
        .add-url-btn {
            display: block; width: 100%; padding: 12px; background-color: #f8f9fa;
            border: 1px dashed var(--medium-grey); border-radius: 4px; cursor: pointer; margin-top: 15px;
        }
        .admin-footer {
            padding: 15px 20px; border-top: 1px solid #eee; background-color: #fff;
            display: flex; gap: 10px;
        }
        .admin-button-overlay {
            flex: 1; padding: 12px; border: none; border-radius: 6px;
            font-size: 16px; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none;
        }
        .admin-button-overlay.primary { background-color: var(--primary-blue); color: white; }
        .admin-button-overlay.secondary { background-color: #6c757d; color: white; }
        .save-feedback {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px);
            background-color: var(--success-green); color: white; padding: 10px 20px;
            border-radius: 6px; opacity: 0; transition: all 0.4s ease; z-index: 101;
        }
    </style>
</head>
<body>

<div id="progress-bar-loader"></div>

<!-- Fixed Header - Visible on all pages -->
<header class="fixed-header">
    <div id="back-tap-area"></div>
    <a href="#home">
        <img src="https://ik.imagekit.io/5lz94dan6e/Screenshot_20251129_112415_Amazon.jpg?updatedAt=1764395709738" alt="Header Image" id="header-img">
    </a>
</header>

<!-- PAGE 0: Home Page -->
<div id="home-page" class="page">
    <main class="content">
        <div class="full-width-image no-gap">
            <img src="https://ik.imagekit.io/goldencodes/Picsart_25-11-09_00-40-33-042.jpg?updatedAt=1762629100597" alt="Sub Header">
        </div>

        <div class="quick-access">
            <div class="quick-access-inner">
                <a href="#orders" class="pill-button" style="text-decoration:none; color: var(--text-color);">Orders</a>
                <button class="pill-button">Buy Again</button>
                <button class="pill-button">Account</button>
                <button class="pill-button">Lists</button>
            </div>
        </div>

        <div class="module">
            <div class="module-header">
                <span class="module-title">Your Orders</span>
                <a href="#orders" class="see-all">See all</a>
            </div>
            <div class="card-row" id="yourOrders-cards"></div>
        </div>

        <div class="module">
            <div class="module-header">
                <span class="module-title">Buy Again</span>
                <a href="#" class="see-all">See all</a>
            </div>
            <div class="card-row" id="buyAgain-cards"></div>
        </div>

        <div class="module">
            <div class="module-header">
                <span class="module-title">Keep shopping for</span>
                <div>
                    <button class="edit-button" id="openAdminButton">Edit</button> |
                    <a href="#" class="see-all" style="margin-left: 5px;">Browsing history</a>
                </div>
            </div>
            <div class="card-row" id="keepShopping-cards"></div>
            <div class="module-footer">
                <a href="#" class="see-more-link">
                    <svg class="arrow-down" viewBox="0 0 24 24"><path d="M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6z"></path></svg>
                    See more
                </a>
            </div>
        </div>
        
        <div class="module">
            <div class="module-header">
                <span class="module-title">Your Lists</span>
                <a href="#" class="see-all">See all</a>
            </div>
            <div class="list-card">
                <div class="list-card-text">
                    <span class="list-title">Shopping List</span>
                    <span class="list-subtitle">Private • Default</span>
                </div>
                <div class="list-card-previews">
                    <div class="preview-square" id="list-preview-1"></div>
                    <div class="preview-square" id="list-preview-2"></div>
                    <div class="preview-square extra-items" id="list-extra-items">+0</div>
                </div>
            </div>
        </div>

        <div class="module">
            <div class="module-header">
                <span class="module-title">Your Account</span>
                <a href="#" class="see-all">See all</a>
            </div>
            <div class="account-buttons">
                <button class="account-button">Your Orders</button>
                <button class="account-button">Your Addresses</button>
                <button class="account-button">Amazon Pay UPI</button>
            </div>
        </div>

        <div class="full-width-image">
            <img src="https://ik.imagekit.io/goldencodes/Picsart_25-11-09_02-08-25-361.jpg?updatedAt=1762634330892" alt="Decorative Image">
        </div>

        <div class="module help-module">
            <h3 class="help-title">Need more help?</h3>
            <button class="help-button">Visit customer service</button>
        </div>
    </main>
</div>

<!-- PAGE 1: "Your Orders" Page -->
<div id="orders-page" class="page">
    <div class="content">
        <div style="padding: 16px;">
            <h1 style="font-size: 1.8rem; font-weight: bold; margin: 0;">Your Orders</h1>
        </div>

        <a href="#admin" class="admin-panel-link">
            <img src="https://ik.imagekit.io/goldencodes/Picsart_25-11-09_03-04-23-916.jpg?updatedAt=1762637690349" alt="Admin Panel">
        </a>

        <div class="module">
            <div class="module-header">
                <h2>Buy again</h2>
                <a class="see-more">See more</a>
            </div>
            <div class="buy-again-grid" id="buy-again-container"></div>
        </div>

        <hr class="separator">

        <div class="module">
            <div class="purchase-history-header">
                <h2>Purchase history</h2>
                <p>Past three months</p>
            </div>
            <div id="purchase-history-container"></div>
        </div>
    </div>
</div>

<!-- PAGE 2: Order Details Page -->
<div id="details-page" class="page">
    <div class="content" id="order-details-content"></div>
</div>

<!-- PAGE 3: Main Admin Panel (REDESIGNED) -->
<div id="admin-page" class="page">
    <div class="content">
        <header class="admin-header-main">
            <h1>Admin Panel</h1>
            <a href="#orders">← Back to Orders</a>
        </header>
        <div class="admin-tabs-container">
            <button class="admin-tab-button active" data-tab="manage-items-tab">Manage Items</button>
            <button class="admin-tab-button" data-tab="global-settings-tab">Global Settings</button>
        </div>

        <!-- TAB 1: MANAGE ITEMS -->
        <div id="manage-items-tab" class="admin-tab-content active">
            <section id="purchase-history-section">
                <div class="admin-section-header">
                    <h2>Purchase History</h2>
                    <button id="add-new-item-btn" class="admin-button">＋ Add New Item</button>
                </div>
                <ul id="purchase-history-admin-list" class="item-list-admin" data-type="purchaseHistory"></ul>
            </section>
            <hr class="separator" style="margin: 20px 0;">
            <section id="buy-again-section">
                <div class="admin-section-header">
                    <h2>Buy Again</h2>
                </div>
                <ul id="buy-again-admin-list" class="item-list-admin" data-type="buyAgain"></ul>
            </section>
        </div>

        <!-- TAB 2: GLOBAL SETTINGS -->
        <div id="global-settings-tab" class="admin-tab-content">
            <div class="admin-section-header">
                <h2>Global Settings</h2>
            </div>
            <div class="admin-settings-form">
                <div class="form-checkbox-group" style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 15px;">
                    <input type="checkbox" id="navToggle" checked>
                    <label for="navToggle">Standard Navigation (Go to Order Details)<br><span style="font-weight:normal; font-size:0.9rem; color:#666;">If OFF, tapping an order goes directly to "Track Package".</span></label>
                </div>

                <div class="form-input-group">
                    <label for="trackBottomImg">Track Package Bottom Image URL:</label>
                    <input type="url" id="trackBottomImg" name="trackBottomImg">
                </div>
                
                <div class="form-input-group">
                    <label for="summaryBottomImg">View Order Detail (Summary Page) Bottom Image URL:</label>
                    <input type="url" id="summaryBottomImg" name="summaryBottomImg">
                </div>

                <label for="extraImageUrl">Details Page Ad Image URL:</label>
                <input type="url" id="extraImageUrl" name="extraImageUrl" placeholder="https://...">
                
                <button id="saveExtraSettingsBtn" class="admin-button secondary">Save Settings</button>
            </div>
        </div>
    </div>
</div>


<!-- PAGE 4: Full Image View Page -->
<div id="image-page" class="page">
    <div class="content" id="image-page-content"></div>
</div>

<!-- PAGE 5: Track Package Page -->
<div id="track-page" class="page">
    <div class="content" id="track-page-content"></div>
</div>

<!-- PAGE 6: Special Item Edit Page (REMOVED - Now handled by modal) -->

<!-- PAGE 7: Order Summary Page -->
<div id="order-summary-page" class="page">
    <div class="content" id="order-summary-content"></div>
</div>

<!-- Admin Panel Overlay for Home Page -->
<div class="admin-overlay" id="adminPanel">
    <div class="admin-container">
        <div class="admin-header">
            <h1>Manage Page Images</h1>
            <p>Add or remove image URLs. Previews update automatically.</p>
        </div>
        <div class="admin-tabs" id="adminTabsContainer"></div>
        <div class="admin-content" id="adminContentContainer"></div>
        <div class="admin-footer">
            <button id="closeAdminButton" class="admin-button-overlay secondary">Close</button>
            <button id="saveButton" class="admin-button-overlay primary">Save & Close</button>
        </div>
    </div>
</div>
<div class="save-feedback" id="saveFeedback">Saved Successfully!</div>

<!-- REDESIGNED Admin Modal for Add/Edit Item -->
<div class="admin-modal-overlay" id="item-modal">
    <div class="admin-modal">
        <header class="modal-header">
            <h2 id="modal-title">Add New Item</h2>
            <button class="modal-close-btn" id="modal-close-btn">&times;</button>
        </header>
        <form class="modal-body" id="item-form">
            <input type="hidden" id="editingItemId" name="editingItemId">
            
            <details class="form-section-accordion" open>
                <summary>Basic Info</summary>
                <div class="form-section-accordion-content">
                    <div class="form-input-group">
                        <label for="itemType">Item Type</label>
                        <select id="itemType" name="itemType"><option value="purchaseHistory">Purchase History</option><option value="buyAgain">Buy Again</option></select>
                    </div>
                    <div class="form-input-group">
                        <label for="itemName">Product Name</label>
                        <input type="text" id="itemName" name="itemName" required>
                    </div>
                    <div class="form-input-group">
                        <label for="itemImage">Image URL</label>
                        <input type="url" id="itemImage" name="itemImage" required>
                    </div>
                    <div class="form-input-group">
                        <label for="itemImagePageUrl">Image Page URL (for fullscreen view)</label>
                        <input type="url" id="itemImagePageUrl" name="itemImagePageUrl">
                    </div>
                </div>
            </details>

            <details class="form-section-accordion">
                <summary>Delivery & Dates</summary>
                <div class="form-section-accordion-content">
                    <div class="form-input-group">
                        <label for="deliveryStatus">Delivery Status Text</label>
                        <select id="deliveryStatus" name="deliveryStatus"><option>Delivered on</option><option>Delivered Today</option><option>Arriving tomorrow</option><option>Arriving on</option><option>Arriving today</option></select>
                    </div>
                    <div class="form-input-group"><label for="orderDate">Order Date</label><input type="date" id="orderDate" name="orderDate"></div>
                    <div class="form-input-group"><label for="deliveryDate">Delivery Date</label><input type="date" id="deliveryDate" name="deliveryDate"></div>
                    <div class="form-input-group"><label for="eligibleDate">Replacement Eligible Until</label><input type="date" id="eligibleDate" name="eligibleDate"></div>
                </div>
            </details>

            <details class="form-section-accordion">
                <summary>Tracking Details</summary>
                <div class="form-section-accordion-content">
                    <div class="form-input-group"><label for="shippingAddress">Shipping Address</label><textarea id="shippingAddress" name="shippingAddress" rows="3"></textarea></div>
                    <div class="form-input-group"><label for="progressStepImageUrl">Progress/Map Image URL</label><input type="url" id="progressStepImageUrl" name="progressStepImageUrl"></div>
                    <div class="form-input-group"><label for="shareTrackingLink">Share Tracking Link</label><input type="url" id="shareTrackingLink" name="shareTrackingLink"></div>
                    <div class="form-input-group"><label for="trackingId">Tracking ID</label><input type="text" id="trackingId" name="trackingId"></div>
                    <div class="form-checkbox-group"><input type="checkbox" id="carouselToggle"><label for="carouselToggle">Show extended carousel (with Share Tracking)</label></div>
                </div>
            </details>
            
            <details class="form-section-accordion">
                <summary>Order Summary Info</summary>
                <div class="form-section-accordion-content">
                    <div class="form-input-group"><label for="orderNumber">Order Number</label><input type="text" id="orderNumber" name="orderNumber"></div>
                    <div class="form-input-group"><label for="sellerInfo">Seller Info</label><input type="text" id="sellerInfo" name="sellerInfo"></div>
                    <div class="form-input-group"><label for="price">Price (e.g. 1799.00)</label><input type="text" id="price" name="price"></div>
                    <div class="form-input-group"><label for="itemSubtotal">Item(s) Subtotal</label><input type="text" id="itemSubtotal" name="itemSubtotal"></div>
                    <div class="form-input-group"><label for="shippingCost">Shipping Cost</label><input type="text" id="shippingCost" name="shippingCost"></div>
                    <div class="form-input-group"><label for="grandTotal">Grand Total</label><input type="text" id="grandTotal" name="grandTotal"></div>
                    <div class="form-input-group"><label for="paymentMethod">Payment Method Info</label><input type="text" id="paymentMethod" name="paymentMethod" placeholder="e.g. American Express xx-xxxx-1234 Credit Card"></div>
                    <div class="form-checkbox-group"><input type="checkbox" id="handedToResident"><label for="handedToResident">Package was handed to resident</label></div>
                    <div class="form-checkbox-group"><input type="checkbox" id="orderCancelled"><label for="orderCancelled">Order is Cancelled/Not Shipped (Modifies Buttons)</label></div>
                </div>
            </details>
            
            <details class="form-section-accordion">
                <summary>Miscellaneous</summary>
                <div class="form-section-accordion-content">
                    <div class="form-input-group">
                        <label for="shareLink">General Share Link</label>
                        <input type="url" id="shareLink" name="shareLink">
                    </div>
                </div>
            </details>

        </form>
        <footer class="modal-footer">
            <button class="admin-button" style="background-color: #6c757d;" id="modal-cancel-btn">Cancel</button>
            <button class="admin-button secondary" id="modal-save-btn">Save Changes</button>
        </footer>
    </div>
</div>


<!-- Fixed Footer - Visible on all pages -->
<footer class="fixed-footer">
    <img src="https://ik.imagekit.io/5lz94dan6e/Picsart_25-11-28_09-08-31-792.jpg?updatedAt=1764301143323" alt="Footer Image" id="footer-img">
</footer>

<script>
document.addEventListener('DOMContentLoaded', () => {

    const DB = {
        get: (key) => JSON.parse(localStorage.getItem(key)) || [],
        set: (key, data) => localStorage.setItem(key, JSON.stringify(data)),
        getValue: (key) => localStorage.getItem(key) || '',
        setValue: (key, value) => localStorage.setItem(key, value),
    };

    const HEADER_URLS = {
        home: 'https://ik.imagekit.io/goldencodes/Picsart_25-11-07_04-28-27-724.jpg?updatedAt=1762470033938',
        other: 'https://ik.imagekit.io/5lz94dan6e/Screenshot_20251129_112415_Amazon.jpg?updatedAt=1764395709738'
    };

    function initializeDefaultData() {
        if (!localStorage.getItem('initialized')) {
            const defaultBuyAgain = [
                { id: 1, name: 'Writing Pad for Notes and Doodling', imageUrl: 'https://m.media-amazon.com/images/I/71d1g4ign5L._AC_UY218_.jpg', imagePageUrl: 'https://m.media-amazon.com/images/I/71d1g4ign5L.jpg', orderDate: '2025-10-15' },
                { id: 2, name: 'Hawkins Contura Hard Anodised Aluminium Pressure Cooker', imageUrl: 'https://m.media-amazon.com/images/I/514d-tD+i8L._AC_UY218_.jpg', imagePageUrl: 'https://m.media-amazon.com/images/I/514d-tD+i8L.jpg', orderDate: '2025-10-20' },
            ];
            const defaultPurchaseHistory = [
                 { 
                    id: 101, name: 'Noise Twist Go Round dial Smartwatch with 1.39" Display', 
                    imageUrl: 'https://m.media-amazon.com/images/I/61TapeOXotL._AC_UY218_.jpg', 
                    imagePageUrl: 'https://m.media-amazon.com/images/I/61TapeOXotL.jpg', 
                    orderDate: '2025-11-01', deliveryDate: '2025-11-05', eligibleDate: '2025-11-15', 
                    deliveryStatusText: 'Delivered on', 
                    shareLink: 'https://www.amazon.in/dp/B0CKL65175', 
                    shippingAddress: '1 Infinite Loop\nCupertino, CA 95014\nUnited States',
                    progressStepImageUrl: 'https://ik.imagekit.io/5lz94dan6e/Picsart_25-11-14_11-02-34-382.jpg?updatedAt=1763098993861',
                    shareTrackingLink: 'https://track.amazon.com/tracking/12345XYZ',
                    trackingId: 'AMZ987654321',
                    carouselToggle: true,
                    orderNumber: "404-1234567-7654321",
                    handedToResident: true,
                    sellerInfo: "Appario Retail Private Ltd",
                    price: "1799.00",
                    itemSubtotal: "1799.00",
                    shippingCost: "0.00",
                    grandTotal: "1799.00",
                    paymentMethod: "American Express xx-xxxx-8970 Credit Card",
                    orderCancelled: false
                 },
                 { 
                    id: 102, name: 'Amazon Pay Mobile Prepaid Online Recharge Service', 
                    imageUrl: 'https://m.media-amazon.com/images/I/51j4jB5a3rL.png', 
                    imagePageUrl: 'https://m.media-amazon.com/images/I/51j4jB5a3rL.png', 
                    orderDate: '2025-10-28', deliveryDate: '2025-10-28', eligibleDate: '2025-11-07', 
                    deliveryStatusText: 'Delivered on', 
                    shareLink: '', shippingAddress: '',
                    progressStepImageUrl: '',
                    shareTrackingLink: '',
                    trackingId: '',
                    carouselToggle: false,
                    orderNumber: "D01-9876543-2109876",
                    handedToResident: false,
                    sellerInfo: "Amazon Pay",
                    price: "299.00",
                    itemSubtotal: "299.00",
                    shippingCost: "0.00",
                    grandTotal: "299.00",
                    paymentMethod: "Amazon Pay Balance",
                    orderCancelled: false
                 },
            ];
            DB.set('buyAgainItems', defaultBuyAgain);
            DB.set('purchaseHistoryItems', defaultPurchaseHistory);
            DB.setValue('extraImageUrl', 'https://ik.imagekit.io/goldencodes/Screenshot_20251111_205647_Amazon.jpg?updatedAt=1762881134774');
            DB.set('keepShopping', []); // Initialize home page sections
            DB.set('yourLists', []);
            
            // New Default Settings
            DB.setValue('navBehaviorToggle', 'true'); // Default ON
            DB.setValue('trackPageBottomImgUrl', 'https://ik.imagekit.io/5lz94dan6e/Screenshot_20251114_113417_Amazon.jpg?updatedAt=1763100284624');
            DB.setValue('orderSummaryBottomImgUrl', 'https://ik.imagekit.io/goldencodes/Screenshot_20251031_113529_Chrome.jpg?updatedAt=1761935756206');
            
            localStorage.setItem('initialized', 'true');
        }
    }

    const pages = document.querySelectorAll('.page');
    
    function showPage(pageId, params = null) {
        const loader = document.getElementById('progress-bar-loader');
        const currentlyActivePage = document.querySelector('.page.active .content');
        const headerImg = document.getElementById('header-img');

        // Update header image based on page
        headerImg.src = (pageId === 'home-page') ? HEADER_URLS.home : HEADER_URLS.other;

        if (currentlyActivePage) {
            currentlyActivePage.classList.add('content-loading');
        }
        loader.classList.add('visible');

        setTimeout(() => {
            pages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                if (pageId === 'home-page') {
                    renderHomePageContent();
                } else if (pageId === 'orders-page') {
                    renderAllOrdersPageContent();
                } else if (pageId === 'details-page' && params) {
                    renderOrderDetails(params.id);
                } else if (pageId === 'image-page' && params) {
                    renderImagePage(params);
                } else if (pageId === 'track-page' && params) {
                    renderTrackPage(params.id);
                    adjustStickyHeaderTop();
                } else if (pageId === 'order-summary-page' && params) {
                    renderOrderSummaryPage(params.id);
                } else if (pageId === 'admin-page') {
                    renderAdminPanel();
                }
                
                targetPage.classList.add('active');
                const newContent = targetPage.querySelector('.content');
                if (newContent) {
                    newContent.classList.remove('content-loading');
                }
                window.scrollTo(0, 0);
            }
            loader.classList.remove('visible');
        }, 500);
    }

    function handleRouteChange() {
        const hash = window.location.hash || '#home';
        
        if (hash.startsWith('#details-')) {
            const id = parseInt(hash.split('-')[1]);
            showPage('details-page', { id });
        } else if (hash.startsWith('#image-')) {
            const [, id, type] = hash.split('-');
            showPage('image-page', { id: parseInt(id), type });
        } else if (hash.startsWith('#track-')) {
            const id = parseInt(hash.split('-')[1]);
            showPage('track-page', { id });
        } else if (hash.startsWith('#order-summary-')) {
            const id = parseInt(hash.split('-')[2]);
            showPage('order-summary-page', { id });
        } else if (hash === '#admin') {
            showPage('admin-page');
        } else if (hash === '#orders') {
            showPage('orders-page');
        } else {
            showPage('home-page');
        }
    }
    
    function formatIndianCurrency(value) {
        if (!value && value !== 0) return '';
        let numStr = String(value).replace(/[^0-9.-]/g, '');
        let number = parseFloat(numStr);
        if (isNaN(number)) return '';
        
        return new Intl.NumberFormat('en-IN', {
            style: 'currency',
            currency: 'INR',
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        }).format(number);
    }

    function truncateString(str, num) {
        if (!str) return '';
        if (str.length <= num) {
            return str;
        }
        return str.slice(0, num) + '...';
    }

    function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        const userTimezoneOffset = date.getTimezoneOffset() * 60000;
        const adjustedDate = new Date(date.getTime() + userTimezoneOffset);
        return adjustedDate.toLocaleDateString('en-GB', { day: 'numeric', month: 'long', year: 'numeric' });
    }
    
    // --- HOME PAGE RENDERING ---
    function createCard(imageUrl) {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `<img src="${imageUrl}" alt="Product Image">`;
        return card;
    }
    
    function renderHomePageCardSection(sectionKey) {
        const container = document.getElementById(`${sectionKey}-cards`);
        if (!container) return;
        
        let items;
        let placeholderText = 'Click "Edit" to add images.';
        
        if (sectionKey === 'yourOrders') {
            items = DB.get('purchaseHistoryItems').map(item => item.imageUrl);
            placeholderText = 'No recent orders.';
        } else if (sectionKey === 'buyAgain') {
             items = DB.get('buyAgainItems').map(item => item.imageUrl);
             placeholderText = 'No items to buy again.';
        } else {
            items = DB.get(sectionKey);
        }

        container.innerHTML = '';
        if (items && items.length > 0 && items.some(url => url && url.trim())) {
            items.forEach(url => { if (url && url.trim()) container.appendChild(createCard(url)); });
        } else {
            container.innerHTML = `<p class="placeholder-text">${placeholderText}</p>`;
        }
    }

    function loadListPreviews() {
        const listImages = DB.get('yourLists');
        const preview1 = document.getElementById('list-preview-1');
        const preview2 = document.getElementById('list-preview-2');
        const extraItems = document.getElementById('list-extra-items');
        
        if(preview1) preview1.style.backgroundImage = listImages[0] ? `url(${listImages[0]})` : 'none';
        if(preview2) preview2.style.backgroundImage = listImages[1] ? `url(${listImages[1]})` : 'none';
        if(extraItems) {
            const extraCount = Math.max(0, listImages.length - 2);
            extraItems.textContent = `+${extraCount}`;
            extraItems.style.display = extraCount > 0 ? 'flex' : 'none';
        }
    }

    function renderHomePageContent() {
        renderHomePageCardSection('yourOrders');
        renderHomePageCardSection('buyAgain');
        renderHomePageCardSection('keepShopping');
        loadListPreviews();
    }

    // --- ORDERS PAGE RENDERING ---
    function renderBuyAgainItems() {
        const items = DB.get('buyAgainItems');
        const container = document.getElementById('buy-again-container');
        if(!container) return;
        container.innerHTML = '';
        items.forEach(item => {
            container.innerHTML += `
                <div class="buy-again-card">
                    <img src="${item.imageUrl}" alt="${item.name}">
                    <p>${item.name}</p> 
                </div>`;
        });
    }

    function renderPurchaseHistory() {
        const items = DB.get('purchaseHistoryItems');
        const container = document.getElementById('purchase-history-container');
        if(!container) return;
        
        // CHECK TOGGLE STATE
        const navBehaviorToggle = DB.getValue('navBehaviorToggle') === 'true';

        container.innerHTML = '';
        items.forEach(item => {
            const statusText = item.deliveryStatusText || 'Delivered on';
            let statusDisplay = '';

            if (['Delivered on', 'Arriving on'].includes(statusText)) {
                statusDisplay = item.deliveryDate ? `${statusText} ${formatDate(item.deliveryDate)}` : statusText.replace(' on', '');
            } else {
                statusDisplay = statusText;
            }
            
            // Apply Logic: If Toggle ON (true) -> Details, If OFF (false) -> Track
            const linkHref = navBehaviorToggle ? `#details-${item.id}` : `#track-${item.id}`;

            // CHECK IF STATUS IS ARRIVING (Logic for Green Text & Hiding Name)
            // User requested: "arriving on, Arriving today, Arriving tomorrow"
            const isGreenStatus = ['Arriving on', 'Arriving today', 'Arriving tomorrow'].some(s => statusText.startsWith(s));

            if (isGreenStatus) {
                // Layout for Arriving Items:
                // 1. Hide Product Name.
                // 2. Status Display takes place of name (same font style) with color #3E8277.
                // 3. Remove duplicate status below.
                container.innerHTML += `
                <div class="purchase-item-card">
                    <div class="item-image"><img src="${item.imageUrl}" alt="${item.name}"></div>
                    <div class="item-info">
                         <a href="${linkHref}" class="item-name" style="color: #3E8277; font-weight: bold; text-decoration: none;">${statusDisplay}</a>
                    </div>
                </div>`;
            } else {
                // Standard Layout for other statuses
                container.innerHTML += `
                <div class="purchase-item-card">
                    <div class="item-image"><img src="${item.imageUrl}" alt="${item.name}"></div>
                    <div class="item-info">
                         <a href="${linkHref}" class="item-name">${item.name}</a>
                        <p class="item-status">${statusDisplay}</p>
                    </div>
                </div>`;
            }
        });
    }

    function renderAllOrdersPageContent() {
        renderBuyAgainItems();
        renderPurchaseHistory();
    }

    // --- OTHER PAGE RENDERING ---
    function renderImagePage(params) {
        const { id, type } = params;
        const key = type === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
        const items = DB.get(key);
        const item = items.find(i => i.id === id);
        const container = document.getElementById('image-page-content');
        
        if (item && item.imagePageUrl) {
            container.innerHTML = `<img src="${item.imagePageUrl}" alt="${item.name}">`;
        } else {
            container.innerHTML = '<p>Image not available.</p>';
        }
    }

    function renderOrderDetails(itemId) {
        const items = DB.get('purchaseHistoryItems');
        const item = items.find(p => p.id === itemId);
        const container = document.getElementById('order-details-content');
        if (!item) {
            container.innerHTML = '<p>Order not found.</p>';
            return;
        }
        
        const imageLinkStart = item.imagePageUrl ? `<a href="#image-${item.id}-purchaseHistory">` : '';
        const imageLinkEnd = item.imagePageUrl ? `</a>` : '';
        
        const extraImageUrl = DB.getValue('extraImageUrl');
        const extraImageHtml = extraImageUrl ? `<img src="${extraImageUrl}" alt="Advertisement" class="details-page-ad-image">` : '';
        
        const statusText = item.deliveryStatusText || 'Delivered on';
        let statusDisplay = '';
        if (['Delivered on', 'Arriving on'].includes(statusText)) {
            statusDisplay = item.deliveryDate ? `${statusText} ${formatDate(item.deliveryDate)}` : statusText.replace(' on', '');
        } else {
            statusDisplay = statusText;
        }

        container.innerHTML = `
            <div class="product-info-module">
                ${imageLinkStart}
                    <img src="${item.imageUrl}" alt="${item.name}" class="product-image">
                ${imageLinkEnd}
                <div class="product-details">
                    <span class="product-name">${item.name}</span>
                    <span class="share-item" data-product-name="${item.name}" data-share-link="${item.shareLink || ''}">Share this item</span>
                </div>
            </div>
            <div class="delivery-status-module">
                <div class="delivery-status">
                    <div class="icon">&#10003;</div>
                    <div>
                        <div class="text-bold">${statusDisplay}</div>
                        <div>Package was handed to resident</div>
                    </div>
                </div>
                <div class="delivery-feedback">
                    <div class="feedback-text">Your delivery feedback</div>
                    <div class="stars">★★★★★</div>
                </div>
                <a href="#track-${item.id}" class="list-button"><span>Track package</span><span class="arrow">&gt;</span></a>
            </div>
            <hr class="separator">
            <div class="module-with-buttons">
                <h3>Need help with your item?</h3>
                <a href="#admin" class="list-button admin-edit-trigger" data-id="${item.id}" data-type="purchaseHistory"><span>Get product support</span><span class="arrow">&gt;</span></a>
                <a href="#" class="list-button">
                    <span class="button-text">
                        Replace item
                        <span class="sub-text">Eligible till ${formatDate(item.eligibleDate)}</span>
                    </span>
                    <span class="arrow">&gt;</span>
                </a>
            </div>
            
            <div class="module-with-buttons">
                <a href="#" class="list-button"><span>Buy it again</span><span class="arrow">&gt;</span></a>
            </div>

            <hr class="separator">

            <div class="module-with-buttons">
                <h3>How's your item?</h3>
                <a href="#" class="list-button"><span>Write a product review</span><span class="arrow">&gt;</span></a>
                <a href="#" class="list-button"><span>Create a video review</span><span class="arrow">&gt;</span></a>
                <a href="#" class="list-button"><span>Leave seller feedback</span><span class="arrow">&gt;</span></a>
            </div>

            <div class="module-with-buttons">
                <h3>Order info</h3>
                <a href="#order-summary-${item.id}" class="list-button"><span>View order details</span><span class="arrow">&gt;</span></a>
                <a href="#" class="list-button"><span>Share gift receipt</span><span class="arrow">&gt;</span></a>
                <a href="#" class="list-button"><span>Download Invoice</span><span class="arrow">&gt;</span></a>
            </div>

            <hr class="separator">
            <div class="details-page-footer">Ordered on ${formatDate(item.orderDate)}</div>
            ${extraImageHtml}
            `;
    }

    function renderTrackPage(itemId) {
        const container = document.getElementById('track-page-content');
        const items = DB.get('purchaseHistoryItems');
        const item = items.find(p => p.id === itemId);

        if (!item) {
            container.innerHTML = '<p>Item not found.</p>';
            return;
        }

        const statusText = item.deliveryStatusText || 'Delivered on';
        let statusDisplay = '';
        if (['Delivered on', 'Arriving on'].includes(statusText)) {
            statusDisplay = item.deliveryDate ? `${statusText} ${formatDate(item.deliveryDate)}` : statusText.replace(' on', '');
        } else {
            statusDisplay = statusText;
        }
        
        const defaultAddress = "Shipping address not set. Please add it in the Admin Panel.";
        const address = item.shippingAddress || defaultAddress;

        const defaultProgressImg = 'https://ik.imagekit.io/5lz94dan6e/Picsart_25-11-14_11-02-34-382.jpg?updatedAt=1763098993861';
        const progressImg = item.progressStepImageUrl || defaultProgressImg;
        
        // GET GLOBAL SETTING IMAGE FOR BOTTOM
        const bottomImg = DB.getValue('trackPageBottomImgUrl') || 'https://ik.imagekit.io/5lz94dan6e/Screenshot_20251114_113417_Amazon.jpg?updatedAt=1763100284624';
        
        let carouselHtml = '';
        if (item.carouselToggle) {
            carouselHtml = `
                <div class="button-carousel">
                    <a href="#" class="action-button">Update delivery instructions</a>
                    <a href="#" class="action-button share-tracking-btn" data-tracking-link="${item.shareTrackingLink || ''}" data-product-name="${item.name || ''}">Share tracking</a>
                    <a href="#" class="action-button">Request cancellation</a>
                    <a href="#" class="action-button">Buy again</a>
                </div>
                <div class="shipped-with-info">
                    <h3>Shipped with Amazon</h3>
                    <p>Tracking ID: ${item.trackingId || 'N/A'}</p>
                    <a href="#">see all updates</a>
                </div>
            `;
        } else {
            carouselHtml = `
                <div class="button-carousel">
                    <a href="#" class="action-button">Update delivery instructions</a>
                    <a href="#" class="action-button">Request cancellation</a>
                    <a href="#" class="action-button">Buy again</a>
                </div>
            `;
        }

        container.innerHTML = `
            <div class="track-module sticky-track-header">
                <div class="track-module-header">
                    <h2>${statusDisplay}</h2>
                    <a href="#orders" class="see-all-orders">see all orders</a>
                </div>
                <div class="track-product-image-container">
                    <img src="${item.imageUrl}" alt="${item.name}" class="track-product-image">
                </div>
                <hr class="thin-separator">
            </div>

            <img src="${progressImg}" alt="Delivery Status Map" class="full-width-image">
            
            ${carouselHtml}

            <div class="track-module">
                <hr class="thick-separator">
                <div class="shipping-address-section">
                    <h3>Shipping Address</h3>
                    <p>${address}</p>
                </div>
                <hr class="thick-separator">
                <div class="order-info-section">
                    <h2>Order Info</h2>
                    <hr class="thick-separator-light">
                    <a href="#order-summary-${itemId}" class="order-details-link">
                        <span>View order details</span>
                        <span class="arrow">&gt;</span>
                    </a>
                    <hr class="thick-separator-light">
                </div>
            </div>
            <img src="${bottomImg}" alt="Order Details Summary" class="full-width-image">
        `;
    }

    function renderOrderSummaryPage(itemId) {
        const container = document.getElementById('order-summary-content');
        const items = DB.get('purchaseHistoryItems');
        const item = items.find(p => p.id === itemId);

        if (!item) {
            container.innerHTML = '<p>Item details not found.</p>';
            return;
        }
        
        // GET GLOBAL SETTING IMAGE FOR BOTTOM (VIEW ORDER DETAIL)
        const bottomImg = DB.getValue('orderSummaryBottomImgUrl') || 'https://ik.imagekit.io/goldencodes/Screenshot_20251031_113529_Chrome.jpg?updatedAt=1761935756206';

        // LOGIC CHANGE: Only show text if Delivery Status Text is exactly "Delivered on"
        let deliveryStatusText = '';
        if (item.deliveryStatusText === 'Delivered on') {
            deliveryStatusText = item.handedToResident ? 'Package was handed to resident' : 'Package was left at door';
        }

        const returnInfoText = item.eligibleDate ? `Return window closed on ${formatDate(item.eligibleDate)}` : '';
        
        // Dynamic Payment Method: Item Specific -> Global Default -> Fallback
        const globalPayment = DB.getValue('globalPaymentMethod');
        const paymentMethodText = item.paymentMethod || globalPayment || 'American Express Credit Card';

        // Logic for BUTTONS based on "Order is Cancelled" Toggle
        let buttonGroupHtml = '';
        if (item.orderCancelled) {
            // Cancelled State: Show Cancel, Track, Review. Hide Support, Buy Again, Feedback.
            buttonGroupHtml = `
                <a href="#track-${item.id}" class="summary-action-button">Track package</a>
                <button class="summary-action-button">Cancel items</button>
                <button class="summary-action-button">Write a product review</button>
            `;
        } else {
            // Normal State
            buttonGroupHtml = `
                <a href="#admin" class="summary-action-button admin-edit-trigger" data-id="${item.id}" data-type="purchaseHistory">Get product support</a>
                <a href="#" class="summary-action-button">Buy it again</a>
                <a href="#track-${item.id}" class="summary-action-button">Track package</a>
                <button class="summary-action-button">Leave seller feedback</button>
                <button class="summary-action-button">Leave delivery feedback</button>
                <button class="summary-action-button">Write a product review</button>
            `;
        }

        container.innerHTML = `
            <div class="summary-top-bar">
                <span id="summary-back-btn" class="back-arrow">&lt;</span>
                <span class="title">Your Orders</span>
            </div>
            <div class="summary-page-background">
                <div class="summary-card">
                    <h2>Order Details</h2>
                    <div class="summary-grid">
                        <span class="label">Order date</span>
                        <span class="value">${formatDate(item.orderDate)}</span>
                    </div>
                    <div class="summary-grid">
                        <span class="label regular">Order number</span>
                        <span class="value">${item.orderNumber || ''}</span>
                    </div>
                    <hr class="card-line">
                    <div class="summary-nav-row">
                        <span>Download Invoice</span>
                        <span class="arrow">&gt;</span>
                    </div>
                </div>

                <div class="summary-card">
                    <div class="product-card-delivery-status">
                        <h2>${item.deliveryStatusText || 'Delivered on'} ${formatDate(item.deliveryDate)}</h2>
                        <p>${deliveryStatusText}</p>
                    </div>
                    <hr class="card-line">
                    <div class="product-card-info">
                        <img src="${item.imageUrl}" alt="${item.name}">
                        <div class="details">
                            <p class="title">${item.name}</p>
                            <p><span class="seller-label">Sold by : </span><a href="#" class="seller-name">${item.sellerInfo || ''}</a></p>
                            <p>${returnInfoText}</p>
                            <p class="price">${formatIndianCurrency(item.price)}</p>
                        </div>
                    </div>
                    <div class="summary-button-group">
                        ${buttonGroupHtml}
                    </div>
                </div>

                <div class="summary-card">
                    <h2>Payment method</h2>
                    <hr class="card-line">
                    <div class="payment-card">
                        <p>${paymentMethodText}</p>
                    </div>
                </div>

                <div class="summary-card">
                    <h2>Ship to</h2>
                    <hr class="card-line">
                    <div class="address-card">
                        <p>${item.shippingAddress || ''}</p>
                    </div>
                </div>

                <div class="summary-card">
                    <h2>Order Summary</h2>
                    <hr class="card-line">
                    <div class="summary-grid">
                        <span class="label regular">Item(s) Subtotal:</span>
                        <span class="value">${formatIndianCurrency(item.itemSubtotal)}</span>
                    </div>
                    <div class="summary-grid">
                        <span class="label regular">Shipping:</span>
                        <span class="value">${formatIndianCurrency(item.shippingCost)}</span>
                    </div>
                    <hr class="card-line">
                    <div class="summary-grid">
                        <span class="label">Grand Total:</span>
                        <span class="value bold">${formatIndianCurrency(item.grandTotal)}</span>
                    </div>
                </div>
                
                <div class="summary-card">
                    <h2>Recommended for you based on "${truncateString(item.name, 20)}"</h2>
                    <img src="https://ik.imagekit.io/goldencodes/Screenshot_20251115_121149_Chrome.jpg" alt="Recommended Products" style="width: 100%; height: auto; display: block;">
                </div>

                <img src="${bottomImg}" alt="Promotional Image" style="width: 100%; height: auto; display: block; padding: 0 8px 8px 8px; box-sizing: border-box;">
            </div>
        `;
        
        document.getElementById('summary-back-btn').addEventListener('click', () => { window.history.back(); });
    }

    // --- REDESIGNED ADMIN PANEL LOGIC ---
    function renderAdminList(type) {
        const key = type === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
        const listId = type === 'buyAgain' ? 'buy-again-admin-list' : 'purchase-history-admin-list';
        const items = DB.get(key);
        const listElement = document.getElementById(listId);
        if (!listElement) return;

        listElement.innerHTML = '';
        if(items.length === 0) {
            listElement.innerHTML = `<p style="padding-left: 5px; color: #666;">No items in this category yet.</p>`;
            return;
        }

        items.forEach(item => {
            const card = document.createElement('li');
            card.className = 'item-list-admin-card';
            card.setAttribute('draggable', 'true');
            card.dataset.id = item.id;
            card.innerHTML = `
                <div class="item-preview" style="background-image: url('${item.imageUrl || ''}')"></div>
                <div class="item-info-admin"><p>${item.name || 'Unnamed Item'}</p></div>
                <div class="item-actions">
                    <button class="admin-duplicate-btn" data-id="${item.id}" data-type="${type}">Duplicate</button>
                    <button class="admin-edit-btn" data-id="${item.id}" data-type="${type}">Edit</button>
                    <button class="admin-delete-btn" data-id="${item.id}" data-type="${type}">Delete</button>
                </div>`;
            listElement.appendChild(card);
        });
    }

    function renderAdminPanel() {
        // Load Global Settings
        document.getElementById('extraImageUrl').value = DB.getValue('extraImageUrl');
        document.getElementById('navToggle').checked = DB.getValue('navBehaviorToggle') === 'true';
        document.getElementById('trackBottomImg').value = DB.getValue('trackPageBottomImgUrl');
        document.getElementById('summaryBottomImg').value = DB.getValue('orderSummaryBottomImgUrl');
        document.getElementById('globalPaymentMethod').value = DB.getValue('globalPaymentMethod');

        document.getElementById('saveExtraSettingsBtn').addEventListener('click', () => {
             DB.setValue('extraImageUrl', document.getElementById('extraImageUrl').value);
             DB.setValue('navBehaviorToggle', document.getElementById('navToggle').checked ? 'true' : 'false');
             DB.setValue('trackPageBottomImgUrl', document.getElementById('trackBottomImg').value);
             DB.setValue('orderSummaryBottomImgUrl', document.getElementById('summaryBottomImg').value);
             DB.setValue('globalPaymentMethod', document.getElementById('globalPaymentMethod').value);
             alert('Settings Saved!');
        });
        renderAdminList('purchaseHistory');
        renderAdminList('buyAgain');
    }

    const itemModal = document.getElementById('item-modal');
    const modalTitle = document.getElementById('modal-title');
    const itemForm = document.getElementById('item-form');
    
    function openModalForEdit(itemId, type) {
        const key = type === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
        const items = DB.get(key);
        const item = items.find(i => i.id === itemId);
        if (!item) return;

        modalTitle.textContent = 'Edit Item';
        document.getElementById('modal-save-btn').textContent = 'Update Changes';
        
        itemForm.editingItemId.value = item.id;
        itemForm.itemType.value = type;
        itemForm.itemName.value = item.name || '';
        itemForm.itemImage.value = item.imageUrl || '';
        itemForm.itemImagePageUrl.value = item.imagePageUrl || '';
        itemForm.deliveryStatus.value = item.deliveryStatusText || 'Delivered on';
        itemForm.orderDate.value = item.orderDate || '';
        itemForm.deliveryDate.value = item.deliveryDate || '';
        itemForm.eligibleDate.value = item.eligibleDate || '';
        itemForm.shippingAddress.value = item.shippingAddress || '';
        itemForm.progressStepImageUrl.value = item.progressStepImageUrl || '';
        itemForm.shareTrackingLink.value = item.shareTrackingLink || '';
        itemForm.trackingId.value = item.trackingId || '';
        itemForm.carouselToggle.checked = !!item.carouselToggle;
        itemForm.orderNumber.value = item.orderNumber || '';
        itemForm.sellerInfo.value = item.sellerInfo || '';
        itemForm.price.value = item.price || '';
        itemForm.itemSubtotal.value = item.itemSubtotal || '';
        itemForm.shippingCost.value = item.shippingCost || '';
        itemForm.grandTotal.value = item.grandTotal || '';
        itemForm.paymentMethod.value = item.paymentMethod || '';
        itemForm.handedToResident.checked = !!item.handedToResident;
        itemForm.orderCancelled.checked = !!item.orderCancelled;
        itemForm.shareLink.value = item.shareLink || '';

        itemModal.classList.add('visible');
    }

    function openModalForNew() {
        modalTitle.textContent = 'Add New Item';
        document.getElementById('modal-save-btn').textContent = 'Save Changes';
        itemForm.reset();
        itemForm.editingItemId.value = '';
        itemModal.classList.add('visible');
    }

    function closeModal() {
        itemModal.classList.remove('visible');
    }
    
    document.getElementById('add-new-item-btn').addEventListener('click', openModalForNew);
    document.getElementById('modal-close-btn').addEventListener('click', closeModal);
    document.getElementById('modal-cancel-btn').addEventListener('click', closeModal);

    document.getElementById('modal-save-btn').addEventListener('click', () => {
        const editingId = parseInt(itemForm.editingItemId.value);
        const type = itemForm.itemType.value;
        const key = type === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
        let items = DB.get(key);

        const itemData = {
            name: itemForm.itemName.value, imageUrl: itemForm.itemImage.value,
            imagePageUrl: itemForm.itemImagePageUrl.value, deliveryStatusText: itemForm.deliveryStatus.value,
            orderDate: itemForm.orderDate.value, deliveryDate: itemForm.deliveryDate.value,
            eligibleDate: itemForm.eligibleDate.value, shippingAddress: itemForm.shippingAddress.value,
            progressStepImageUrl: itemForm.progressStepImageUrl.value, shareTrackingLink: itemForm.shareTrackingLink.value,
            trackingId: itemForm.trackingId.value, carouselToggle: itemForm.carouselToggle.checked,
            orderNumber: itemForm.orderNumber.value, sellerInfo: itemForm.sellerInfo.value,
            price: itemForm.price.value, itemSubtotal: itemForm.itemSubtotal.value,
            shippingCost: itemForm.shippingCost.value, grandTotal: itemForm.grandTotal.value,
            paymentMethod: itemForm.paymentMethod.value,
            handedToResident: itemForm.handedToResident.checked, 
            orderCancelled: itemForm.orderCancelled.checked,
            shareLink: itemForm.shareLink.value
        };

        if (editingId) {
            const itemIndex = items.findIndex(item => item.id === editingId);
            if (itemIndex > -1) items[itemIndex] = { ...items[itemIndex], ...itemData };
        } else {
            items.unshift({ id: Date.now(), ...itemData }); // Use unshift to add to the top
        }

        DB.set(key, items);
        renderAdminPanel();
        closeModal();
    });

    document.getElementById('admin-page').addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;
        
        const id = parseInt(target.dataset.id);
        const type = target.dataset.type;

        if (target.classList.contains('admin-edit-btn')) {
            openModalForEdit(id, type);
        } else if (target.classList.contains('admin-delete-btn')) {
            if (confirm('Are you sure you want to delete this item?')) {
                const key = type === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
                let items = DB.get(key);
                items = items.filter(item => item.id !== id);
                DB.set(key, items);
                renderAdminPanel();
            }
        } else if (target.classList.contains('admin-duplicate-btn')) {
            if (confirm('Are you sure you want to duplicate this item? A copy will be added to the top of the list.')) {
                const key = type === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
                let items = DB.get(key);
                const originalItem = items.find(item => item.id === id);

                if (originalItem) {
                    const newItem = JSON.parse(JSON.stringify(originalItem)); // Deep copy
                    newItem.id = Date.now();
                    newItem.name = `${originalItem.name} (Copy)`;
                    items.unshift(newItem);
                    DB.set(key, items);
                    renderAdminPanel();
                }
            }
        }
    });

    document.body.addEventListener('click', (e) => {
        if(e.target.closest('.admin-edit-trigger')) {
            e.preventDefault();
            const trigger = e.target.closest('.admin-edit-trigger');
            const id = parseInt(trigger.dataset.id);
            const type = trigger.dataset.type;
            showPage('admin-page');
            setTimeout(() => openModalForEdit(id, type), 50);
        }
    });
    
    const adminTabs = document.querySelectorAll('.admin-tab-button');
    const adminTabContents = document.querySelectorAll('.admin-tab-content');
    adminTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            adminTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            adminTabContents.forEach(c => c.classList.remove('active'));
            document.getElementById(tab.dataset.tab).classList.add('active');
        });
    });

    // --- DRAG AND DROP REORDERING LOGIC ---
    let draggedItem = null;
    const adminPage = document.getElementById('admin-page');

    adminPage.addEventListener('dragstart', e => {
        draggedItem = e.target.closest('.item-list-admin-card');
        if (!draggedItem) return;
        setTimeout(() => draggedItem.classList.add('dragging'), 0);
    });

    adminPage.addEventListener('dragend', e => {
        if (!draggedItem) return;
        draggedItem.classList.remove('dragging');
        draggedItem = null;
        document.querySelectorAll('.drag-over-top, .drag-over-bottom').forEach(el => {
            el.classList.remove('drag-over-top', 'drag-over-bottom');
        });
    });
    
    adminPage.addEventListener('dragover', e => {
        e.preventDefault();
        const list = e.target.closest('.item-list-admin');
        if (!list || !draggedItem) return;

        const afterElement = getDragAfterElement(list, e.clientY);
        
        list.querySelectorAll('.item-list-admin-card').forEach(el => {
             el.classList.remove('drag-over-top', 'drag-over-bottom');
        });

        if (afterElement) {
            afterElement.classList.add('drag-over-top');
        } else {
            const lastChild = list.querySelector('.item-list-admin-card:not(.dragging):last-child');
            if(lastChild) lastChild.classList.add('drag-over-bottom');
        }
    });

    function getDragAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.item-list-admin-card:not(.dragging)')];
        return draggableElements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
                return { offset: offset, element: child };
            } else {
                return closest;
            }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
    
    adminPage.addEventListener('drop', e => {
        e.preventDefault();
        const list = e.target.closest('.item-list-admin');
        if (!list || !draggedItem) return;

        const listType = list.dataset.type;
        const key = listType === 'buyAgain' ? 'buyAgainItems' : 'purchaseHistoryItems';
        let items = DB.get(key);
        
        const draggedId = parseInt(draggedItem.dataset.id);
        const draggedIndex = items.findIndex(item => item.id === draggedId);
        if (draggedIndex === -1) return;

        const [removed] = items.splice(draggedIndex, 1);
        
        const afterElement = getDragAfterElement(list, e.clientY);
        if (afterElement) {
            const afterId = parseInt(afterElement.dataset.id);
            const newIndex = items.findIndex(item => item.id === afterId);
            items.splice(newIndex, 0, removed);
        } else {
            items.push(removed);
        }

        DB.set(key, items);
        renderAdminList(listType);
    });



    // --- ADMIN PANEL LOGIC (Home Page Overlay) ---
    const SECTIONS = [
        { key: 'keepShopping', title: 'Keep Shopping', note: 'Add URLs for the square product cards.' },
        { key: 'yourLists', title: 'Your Lists', note: 'Add image URLs for the list preview.' }
    ];

    const adminPanel = document.getElementById('adminPanel');
    const openAdminButton = document.getElementById('openAdminButton');
    const closeAdminButton = document.getElementById('closeAdminButton');
    const saveButton = document.getElementById('saveButton');
    const adminTabsContainer = document.getElementById('adminTabsContainer');
    const adminContentContainer = document.getElementById('adminContentContainer');

    function createUrlInput(url = '') {
        const group = document.createElement('div');
        group.className = 'url-input-group';
        group.innerHTML = `
            <div class="url-preview"></div>
            <input type="text" class="url-input" placeholder="https://..." value="">
            <button class="remove-url-btn">&times;</button>
        `;
        const textInput = group.querySelector('.url-input');
        const preview = group.querySelector('.url-preview');
        textInput.value = url;
        if (url) preview.style.backgroundImage = `url(${url})`;

        textInput.addEventListener('input', () => {
            preview.style.backgroundImage = textInput.value ? `url(${textInput.value})` : 'none';
        });
        group.querySelector('.remove-url-btn').addEventListener('click', () => group.remove());
        return group;
    }

    function buildAdminPanel() {
        if (!adminTabsContainer) return;
        adminTabsContainer.innerHTML = '';
        adminContentContainer.innerHTML = '';
        SECTIONS.forEach((section, index) => {
            adminTabsContainer.innerHTML += `<div class="admin-tab" data-tab="${section.key}">${section.title}</div>`;
            const content = document.createElement('div');
            content.className = 'admin-tab-content';
            content.id = `${section.key}-content`;
            content.innerHTML = `
                <p class="admin-note">${section.note}</p>
                <div id="${section.key}-urls"></div>
                <button class="add-url-btn" data-target="${section.key}-urls">+ Add New URL</button>
            `;
            adminContentContainer.appendChild(content);

            if (index === 0) {
                adminTabsContainer.firstElementChild.classList.add('active');
                content.classList.add('active');
            }
        });

        adminTabsContainer.addEventListener('click', e => {
            if (e.target.matches('.admin-tab')) {
                const tabKey = e.target.dataset.tab;
                adminTabsContainer.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                adminContentContainer.querySelectorAll('.admin-tab-content').forEach(c => c.classList.remove('active'));
                e.target.classList.add('active');
                document.getElementById(`${tabKey}-content`).classList.add('active');
            }
        });

        adminContentContainer.addEventListener('click', e => {
            if(e.target.matches('.add-url-btn')) {
                const targetId = e.target.dataset.target;
                document.getElementById(targetId).appendChild(createUrlInput());
            }
        });
    }

    function populateAdminPanel() {
        SECTIONS.forEach(section => {
            const urls = DB.get(section.key);
            const urlListContainer = document.getElementById(`${section.key}-urls`);
            if(!urlListContainer) return;
            urlListContainer.innerHTML = '';
            if (urls.length > 0) {
                urls.forEach(url => urlListContainer.appendChild(createUrlInput(url)));
            } else {
                urlListContainer.appendChild(createUrlInput());
            }
        });
    }
    
    function openAdmin() { populateAdminPanel(); adminPanel.classList.add('visible'); }
    function closeAdmin() { adminPanel.classList.remove('visible'); }

    function saveChanges() {
        SECTIONS.forEach(section => {
            const urlContainer = document.getElementById(`${section.key}-urls`);
            const inputs = urlContainer.querySelectorAll('.url-input');
            const urls = Array.from(inputs).map(input => input.value.trim()).filter(url => url);
            DB.set(section.key, urls);
        });
        const feedback = document.getElementById('saveFeedback');
        feedback.style.transform = 'translateX(-50%) translateY(0)';
        feedback.style.opacity = '1';

        setTimeout(() => {
            feedback.style.transform = 'translateX(-50%) translateY(100px)';
            feedback.style.opacity = '0';
        }, 2000);
        
        renderHomePageContent();
        setTimeout(closeAdmin, 300);
    }

    // --- GLOBAL EVENT LISTENERS & INITIALIZATION ---
    document.body.addEventListener('click', async (e) => {
        if (e.target.classList.contains('share-item')) {
            const productName = e.target.dataset.productName;
            const defaultShareUrl = 'https://www.amazon.in/';
            const customShareUrl = e.target.dataset.shareLink;
            const shareUrl = customShareUrl || defaultShareUrl;
            const shareText = `Check out this product: ${productName}`;
            if (navigator.share) {
                try { await navigator.share({ title: 'Amazon Product', text: `${shareText}`, url: shareUrl }); }
                catch (err) { console.error('Error sharing:', err); }
            } else {
                try { await navigator.clipboard.writeText(`${shareText}\n${shareUrl}`); alert('Link copied to clipboard!'); }
                catch (err) { alert('Failed to copy link.'); }
            }
        } else if (e.target.classList.contains('share-tracking-btn')) {
            e.preventDefault();
            const trackingLink = e.target.dataset.trackingLink;
            const productName = e.target.dataset.productName;
            if (!trackingLink) { alert('No tracking link is available for this item.'); return; }
            const shareText = `Here is the tracking information for the order: ${productName}`;
            if (navigator.share) {
                try { await navigator.share({ title: 'Amazon Order Tracking', text: shareText, url: trackingLink }); }
                catch (err) { console.error('Error sharing tracking link:', err); }
            } else {
                try { await navigator.clipboard.writeText(trackingLink); alert('Tracking link copied to clipboard!'); }
                catch (err) { alert('Failed to copy tracking link.'); }
            }
        }
    });

    const footer = document.querySelector('.fixed-footer');
    footer.addEventListener('click', () => { window.location.hash = '#home'; });

    document.getElementById('back-tap-area').addEventListener('click', () => { window.history.back(); });

    const header = document.querySelector('.fixed-header');
    const loader = document.getElementById('progress-bar-loader');

    function adjustStickyHeaderTop() {
        const headerHeight = header.offsetHeight;
        const stickyHeader = document.querySelector('.sticky-track-header');
        if (stickyHeader) { stickyHeader.style.top = `${headerHeight}px`; }
    }
    
    function setHomePageContentPadding() {
        const headerHeight = document.getElementById('header-img').offsetHeight;
        const footerHeight = document.getElementById('footer-img').offsetHeight;
        const homePageContent = document.querySelector('#home-page .content');
        if (homePageContent) {
            homePageContent.style.paddingTop = `${headerHeight}px`;
            homePageContent.style.paddingBottom = `${footerHeight}px`;
        }
    }

    function adjustLayoutForAllPages() {
        const headerImg = header.querySelector('img');
        const performAdjustment = () => {
            const headerHeight = header.offsetHeight;
            loader.style.top = `${headerHeight}px`;
            pages.forEach(page => {
                if (page.id !== 'home-page') { page.style.paddingTop = `${headerHeight}px`; }
            });
            adjustStickyHeaderTop();
            setHomePageContentPadding();
        };
        if (headerImg.complete) { performAdjustment(); }
        else { headerImg.addEventListener('load', performAdjustment); }
        window.addEventListener('resize', performAdjustment);
    }
    
    // --- Initial Setup Calls ---
    if(openAdminButton) openAdminButton.addEventListener('click', openAdmin);
    if(closeAdminButton) closeAdminButton.addEventListener('click', closeAdmin);
    if(saveButton) saveButton.addEventListener('click', saveChanges);
    if(adminPanel) adminPanel.addEventListener('click', e => { if (e.target === adminPanel) closeAdmin(); });

    initializeDefaultData();
    buildAdminPanel();
    adjustLayoutForAllPages();
    window.addEventListener('hashchange', handleRouteChange);
    handleRouteChange(); 

});
</script>

</body>
</html>
```
